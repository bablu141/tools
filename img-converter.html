reader.onload = function (event) {
    const img = new Image();
    img.src = event.target.result;
    img.onload = function () {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);

        const convertedImage = canvas.toDataURL(`image/${format}`);
        previewContainer.innerHTML = `
            <img src="${convertedImage}" style="max-width: 100%; border-radius: 5px; margin-top: 10px;">
        `;

        const downloadBtn = document.createElement('a');
        downloadBtn.href = convertedImage;
        downloadBtn.download = `converted_image.${format}`;
        downloadBtn.textContent = 'Download Image';
        downloadBtn.style.display = 'block';
        downloadBtn.style.background = '#FFD700';
        downloadBtn.style.color = '#1E1E2F';
        downloadBtn.style.padding = '10px';
        downloadBtn.style.marginTop = '10px';
        downloadBtn.style.textDecoration = 'none';
        downloadBtn.style.borderRadius = '5px';

        previewContainer.appendChild(downloadBtn);
        status.textContent = '';
    };
};
